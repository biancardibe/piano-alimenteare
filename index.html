<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Alimentare Settimanale</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .meal-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .nav-button.active {
            background-color: #1D4ED8;
            /* bg-blue-700 */
            color: white;
            font-weight: 600;
        }

        .day-nav-button.active {
            background-color: #3B82F6;
            /* bg-blue-500 */
            color: white;
            border-color: #3B82F6;
            /* border-blue-500 */
        }

        .view-button {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: #4B5563;
            /* text-gray-600 */
            border-bottom: 3px solid transparent;
            transition: color 0.2s, border-color 0.2s;
        }

        .view-button:hover {
            color: #1D4ED8;
            /* text-blue-700 */
        }

        .view-button.active {
            color: #1D4ED8;
            /* text-blue-700 */
            border-bottom-color: #1D4ED8;
            /* border-blue-700 */
        }

        .shopping-item input[type="checkbox"]:checked+label {
            text-decoration: line-through;
            color: #9CA3AF;
        }

        .shopping-item label span {
            transition: color 0.2s;
        }

        .shopping-item input[type="checkbox"]:checked+label span {
            color: #9CA3AF;
        }

        #sticky-header {
            transition: transform 0.3s ease, opacity 0.3s ease;
            transform: translateY(-100%);
            opacity: 0;
        }

        #sticky-header.visible {
            transform: translateY(0);
            opacity: 1;
        }

        #header-text {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease;
        }

        #header-text.fade-slide-out {
            transform: translateY(-100%);
            opacity: 0;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">

    <div id="sticky-header"
        class="fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-sm shadow-md h-[60px] flex items-center justify-center px-4 z-20">
        <h2 id="header-text" class="text-lg font-bold text-gray-800">
            <span id="sticky-week"></span> - <span id="sticky-day"></span>
        </h2>
    </div>

    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Il Tuo Piano Alimentare</h1>
            <p class="mt-2 text-lg text-gray-600">4 settimane di alimentazione bilanciata</p>
        </header>

        <!-- Main View Navigation -->
        <nav id="view-nav" class="flex justify-center border-b-2 border-gray-200 mb-6">
            <button id="plan-view-btn" class="view-button active">Piano Alimentare</button>
            <button id="list-view-btn" class="view-button">Lista della Spesa</button>
        </nav>

        <!-- Week Navigation -->
        <nav id="week-nav" class="flex justify-center bg-white p-2 rounded-xl shadow-md mb-6 top-2 z-10">
        </nav>

        <!-- Container for Meal Plan View -->
        <div id="plan-view-container">
            <nav id="day-nav" class="flex flex-wrap justify-center gap-2 mb-8">
            </nav>
            <main id="meal-plan-container">
            </main>
        </div>

        <!-- Container for Shopping List View -->
        <div id="list-view-container" class="hidden">
        </div>
    </div>

    <script>
        const mealPlan = {
            sett.1: {
                lun: {
                    colazione: { nome: "Yogurt greco intero e Muesli con Banana", grammatura: "125g + 30g + 150g", descrizione: "Yogurt greco con muesli e una banana a fette." },
                    spuntino_mattutino: { nome: "Kiwi e Mandorle", grammatura: "150g + 30g", descrizione: "Due kiwi freschi accompagnati da mandorle secche." },
                    pranzo: { nome: "Pasta Senatore Cappelli con Ceci e Zucchine", grammatura: "80g + 60g + 200g", descrizione: "Pasta condita con ceci e zucchine saltate." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Petto di tacchino, Bieta e Mirtilli", grammatura: "150g + 100g + 125g", descrizione: "Tacchino al forno con bieta lessa e mirtilli." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                mar: {
                    colazione: { nome: "Pane secco, burro, marmellata e Kiwi", grammatura: "90g + 150g", descrizione: "Pane secco con burro, marmellata e due kiwi." },
                    spuntino_mattutino: { nome: "Banana e Noci", grammatura: "150g + 30g", descrizione: "Una banana fresca e noci secche." },
                    pranzo: { nome: "Riso basmati con Lenticchie e Carote", grammatura: "80g + 60g + 100g", descrizione: "Riso basmati con lenticchie e carote." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Sgombro, Spinaci e Banana", grammatura: "150g + 100g + 150g", descrizione: "Sgombro al naturale con spinaci e una banana." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                mer: {
                    colazione: { nome: "Ricotta di vacca, Muesli e Mirtilli", grammatura: "80g + 30g + 125g", descrizione: "Ricotta fresca con muesli e mirtilli." },
                    spuntino_mattutino: { nome: "Banana e Anacardi", grammatura: "150g + 30g", descrizione: "Una banana e anacardi tostati." },
                    pranzo: { nome: "Farro con Piselli e Pomodori", grammatura: "80g + 60g + 200g", descrizione: "Insalata di farro con piselli e pomodori." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Salmone fresco, Broccoletti e Kiwi", grammatura: "150g + 200g + 150g", descrizione: "Salmone al vapore con broccoletti e due kiwi." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                gio: {
                    colazione: { nome: "Latte di capra, Muesli e Banana", grammatura: "200g + 30g + 150g", descrizione: "Latte di capra con muesli e banana." },
                    spuntino_mattutino: { nome: "Mirtilli e Nocciole", grammatura: "125g + 30g", descrizione: "Mirtilli freschi e nocciole secche." },
                    pranzo: { nome: "Grano saraceno con Fagioli e Zucca gialla", grammatura: "80g + 60g + 200g", descrizione: "Insalata di grano saraceno con fagioli e zucca." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Vitellone, Asparagi e Mirtilli", grammatura: "150g + 100g + 125g", descrizione: "Bistecca di vitellone con asparagi e mirtilli." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                ven: {
                    colazione: { nome: "Pane secco, burro, marmellata e Banana", grammatura: "90g + 150g", descrizione: "Pane secco con burro, marmellata e una banana." },
                    spuntino_mattutino: { nome: "Mirtilli e Mandorle", grammatura: "125g + 30g", descrizione: "Mirtilli freschi e mandorle." },
                    pranzo: { nome: "Riso nero Venere con Sgombro e Zucchine", grammatura: "80g + 60g + 200g", descrizione: "Riso Venere con sgombro e zucchine." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Orata al forno, Peperoni e Kiwi", grammatura: "150g + 150g + 150g", descrizione: "Orata al cartoccio con peperoni e due kiwi." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                sab: {
                    colazione: { nome: "Ricotta di pecora, Muesli e Kiwi", grammatura: "80g + 30g + 150g", descrizione: "Ricotta fresca con muesli e due kiwi." },
                    spuntino_mattutino: { nome: "Banana e Semi di girasole", grammatura: "150g + 20g", descrizione: "Banana con semi di girasole." },
                    pranzo: { nome: "Grano saraceno con Funghi", grammatura: "80g + 150g", descrizione: "Grano saraceno con funghi trifolati." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Bistecca di maiale, Lattuga, Banana", grammatura: "150g + 100g + 150g", descrizione: "Bistecca di maiale con lattuga e una banana." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                dom: {
                    colazione: { nome: "Latte di pecora, Muesli e Banana", grammatura: "200g + 30g + 150g", descrizione: "Latte di pecora con muesli e una banana." },
                    spuntino_mattutino: { nome: "Banana e Noci", grammatura: "150g + 30g", descrizione: "Una banana e noci secche." },
                    pranzo: { nome: "Pasta Senatore Cappelli con Vongole e Zucchine", grammatura: "80g + 60g + 200g", descrizione: "Pasta con vongole e zucchine." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Trota al forno, Fagiolini e Kiwi", grammatura: "150g + 100g + 150g", descrizione: "Trota al forno con fagiolini e due kiwi." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                }
            },
            sett.2: {
                lun: {
                    colazione: { nome: "Yogurt greco e Muesli con Kiwi", grammatura: "125g + 30g + 150g", descrizione: "Yogurt greco con muesli e due kiwi." },
                    spuntino_mattutino: { nome: "Banana e Nocciole", grammatura: "150g + 30g", descrizione: "Una banana fresca accompagnata da nocciole secche." },
                    pranzo: { nome: "Grano saraceno con Ceci e Zucchine", grammatura: "80g + 60g + 200g", descrizione: "Grano saraceno con ceci e zucchine al vapore." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Polpo con patate e prezzemolo, Mirtilli", grammatura: "200g + 200g + 125g", descrizione: "Polpo bollito con patate lesse e mirtilli." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                mar: {
                    colazione: { nome: "Ricotta di vacca con Mirtilli", grammatura: "80g + 125g", descrizione: "Ricotta fresca servita con mirtilli freschi." },
                    spuntino_mattutino: { nome: "Banana e Mandorle", grammatura: "150g + 30g", descrizione: "Una banana fresca e mandorle." },
                    pranzo: { nome: "Riso basmati con Lenticchie e Zucca", grammatura: "80g + 60g + 200g", descrizione: "Riso basmati con lenticchie e cubetti di zucca gialla." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Fegato di bovino, Agretti e Kiwi", grammatura: "150g + 100g + 150g", descrizione: "Fegato saltato in padella con agretti e due kiwi." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                mer: {
                    colazione: { nome: "Ricotta di pecora, Muesli e Banana", grammatura: "80g + 30g + 150g", descrizione: "Ricotta di pecora con muesli e una banana." },
                    spuntino_mattutino: { nome: "Kiwi e Mandorle", grammatura: "150g + 30g", descrizione: "Due kiwi e mandorle secche." },
                    pranzo: { nome: "Penne Senatore Cappelli con Tonno e Zucchine", grammatura: "80g + 60g + 200g", descrizione: "Penne con tonno al naturale e zucchine." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Pesce spada, Insalata di pomodori, Banana", grammatura: "150g + 200g + 150g", descrizione: "Pesce spada alla griglia con pomodori e una banana." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                gio: {
                    colazione: { nome: "Pane secco, burro, marmellata e Kiwi", grammatura: "90g + 150g", descrizione: "Pane secco con burro, marmellata e due kiwi." },
                    spuntino_mattutino: { nome: "Mirtilli e Semi di zucca", grammatura: "125g + 20g", descrizione: "Una coppetta di mirtilli e semi di zucca." },
                    pranzo: { nome: "Farro con Piselli e Zucchine", grammatura: "80g + 60g + 200g", descrizione: "Farro con piselli e zucchine saltate." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Sgombro al forno, Peperoni e Mirtilli", grammatura: "150g + 150g + 125g", descrizione: "Sgombro al forno con peperoni grigliati e mirtilli." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                ven: {
                    colazione: { nome: "Latte di vacca, Muesli e Banana", grammatura: "200g + 30g + 150g", descrizione: "Latte scremato con muesli e una banana." },
                    spuntino_mattutino: { nome: "Banana e Noci", grammatura: "150g + 30g", descrizione: "Una banana fresca e noci." },
                    pranzo: { nome: "Riso basmati con Cozze e Fagiolini", grammatura: "80g + 60g + 100g", descrizione: "Riso con cozze e fagiolini." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Tonno fresco, Asparagi e Kiwi", grammatura: "150g + 100g + 150g", descrizione: "Trancio di tonno fresco con asparagi e due kiwi." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                sab: {
                    colazione: { nome: "Pane secco, burro, marmellata e Mirtilli", grammatura: "90g + 125g", descrizione: "Pane secco con burro, marmellata e mirtilli." },
                    merenda: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Una porzione di fiocchi di latte freschi." },
                    pranzo: { nome: "Pasta Senatore Cappelli con Fagioli e Carote", grammatura: "80g + 60g + 100g", descrizione: "Pasta e fagioli con carote." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Vitellone, Funghi e Banana", grammatura: "150g + 150g + 150g", descrizione: "Bistecca di vitellone ai ferri con funghi e una banana." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                dom: {
                    colazione: { nome: "Ricotta di vacca con Kiwi", grammatura: "80g + 150g", descrizione: "Ricotta fresca accompagnata da due kiwi." },
                    spuntino_mattutino: { nome: "Banana e Mandorle", grammatura: "150g + 30g", descrizione: "Una banana e mandorle." },
                    pranzo: { nome: "Piatto libero", grammatura: "Porzione media", descrizione: "Goditi un pasto libero." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Minestra di verdure e legumi, Mirtilli", grammatura: "Piatto abbondante + 125g", descrizione: "Passato di verdure con lenticchie e mirtilli." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                }
            },
            sett.3: {
                lun: {
                    colazione: { nome: "Yogurt greco, Muesli e Kiwi", grammatura: "125g + 30g + 150g", descrizione: "Yogurt greco con muesli e kiwi a fette." },
                    spuntino_mattutino: { nome: "Banana e Anacardi", grammatura: "150g + 30g", descrizione: "Fette di banana e anacardi." },
                    pranzo: { nome: "Pasta Senatore Cappelli con Ceci e Broccoletti", grammatura: "80g + 60g + 60g", descrizione: "Pasta con ceci e broccoletti di rapa saltati." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Petto di pollo, Carote e Banana", grammatura: "150g + 100g + 150g", descrizione: "Pollo grigliato con carote julienne e una banana." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                mar: {
                    colazione: { nome: "Pane secco, burro, marmellata e Banana", grammatura: "90g + 150g", descrizione: "Pane secco con burro, marmellata e una banana." },
                    spuntino_mattutino: { nome: "Kiwi e Noci", grammatura: "150g + 30g", descrizione: "Due kiwi e noci secche." },
                    pranzo: { nome: "Riso nero Venere con Lenticchie e Peperoni", grammatura: "80g + 60g + 150g", descrizione: "Riso venere con lenticchie e peperoni arrostiti." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Salmone, Fagiolini e Kiwi", grammatura: "150g + 100g + 150g", descrizione: "Salmone al vapore con fagiolini e due kiwi." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                mer: {
                    colazione: { nome: "Ricotta di vacca, Muesli e Mirtilli", grammatura: "80g + 30g + 125g", descrizione: "Ricotta fresca con muesli e mirtilli." },
                    spuntino_mattutino: { nome: "Banana e Mandorle", grammatura: "150g + 30g", descrizione: "Una banana e mandorle." },
                    pranzo: { nome: "Farro con Sgombro e Pomodorini", grammatura: "80g + 60g + 200g", descrizione: "Insalata di farro con sgombro e pomodorini." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Pesce spada, Zucchine e Banana", grammatura: "150g + 200g + 150g", descrizione: "Trancio di pesce spada con zucchine grigliate e una banana." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                gio: {
                    colazione: { nome: "Latte di pecora, Muesli e Banana", grammatura: "200g + 30g + 150g", descrizione: "Tazza di latte di pecora con muesli e banana." },
                    spuntino_mattutino: { nome: "Kiwi e Nocciole", grammatura: "150g + 30g", descrizione: "Due kiwi e nocciole." },
                    pranzo: { nome: "Farro con Fagioli e Zucca", grammatura: "80g + 60g + 200g", descrizione: "Insalata di farro con fagioli e zucca al forno." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Tacchino, Spinaci e Mirtilli", grammatura: "150g + 100g + 125g", descrizione: "Fesa di tacchino con spinaci freschi e mirtilli." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                ven: {
                    colazione: { nome: "Pane secco, burro, marmellata e Kiwi", grammatura: "90g + 150g", descrizione: "Pane secco con burro, marmellata e kiwi." },
                    spuntino_mattutino: { nome: "Mirtilli e Semi di girasole", grammatura: "125g + 20g", descrizione: "Coppetta di mirtilli e semi di girasole." },
                    pranzo: { nome: "Riso basmati con Vongole e Zucchine", grammatura: "80g + 60g + 200g", descrizione: "Riso con vongole al naturale e zucchine." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Sogliola al limone, Asparagi, Banana", grammatura: "150g + 100g + 150g", descrizione: "Filetti di sogliola con limone, asparagi e una banana." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                sab: {
                    colazione: { nome: "Ricotta di vacca con Banana", grammatura: "80g + 150g", descrizione: "Ricotta fresca con una banana a fette." },
                    spuntino_mattutino: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Una porzione di fiocchi di latte." },
                    pranzo: { nome: "Grano saraceno con ragù di lenticchie", grammatura: "80g + 100g", descrizione: "Grano saraceno con ragù di lenticchie e verdure." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Triglie alla livornese, Kiwi", grammatura: "150g + 150g", descrizione: "Triglie con pomodoro e due kiwi." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                dom: {
                    colazione: { nome: "Latte di capra, Muesli e Mirtilli", grammatura: "200g + 30g + 125g", descrizione: "Latte di capra con muesli e mirtilli." },
                    spuntino_mattutino: { nome: "Banana e Arachidi tostate", grammatura: "150g + 30g", descrizione: "Una banana e arachidi." },
                    pranzo: { nome: "Piatto libero", grammatura: "A piacere", descrizione: "Goditi un pasto libero." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Orata, Piselli e Banana", grammatura: "150g + 240g + 150g", descrizione: "Orata al forno con piselli e una banana." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                }
            },
            sett.4: {
                lun: {
                    colazione: { nome: "Yogurt greco, Muesli e Banana", grammatura: "125g + 30g + 150g", descrizione: "Yogurt greco con muesli e banana." },
                    spuntino_mattutino: { nome: "Kiwi e Noci", grammatura: "150g + 30g", descrizione: "Due kiwi e noci." },
                    pranzo: { nome: "Grano saraceno con Ceci e Peperoni", grammatura: "80g + 60g + 150g", descrizione: "Grano saraceno con ceci e peperoni grigliati." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Salmone al vapore, Broccoletti e Kiwi", grammatura: "150g + 200g + 150g", descrizione: "Salmone cotto al vapore con broccoletti e due kiwi." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                mar: {
                    colazione: { nome: "Ricotta di pecora con Mirtilli", grammatura: "80g + 125g", descrizione: "Ricotta di pecora fresca con mirtilli." },
                    spuntino_mattutino: { nome: "Banana e Nocciole", grammatura: "150g + 30g", descrizione: "Una banana e nocciole." },
                    pranzo: { nome: "Riso basmati con Lenticchie e Fagiolini", grammatura: "80g + 60g + 100g", descrizione: "Riso con lenticchie e fagiolini." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Fegato di bovino, Cipolle e Banana", grammatura: "150g + 100g + 150g", descrizione: "Fegato alla veneziana (con cipolle) e una banana." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                mer: {
                    colazione: { nome: "Ricotta di pecora, Muesli e Kiwi", grammatura: "80g + 30g + 150g", descrizione: "Ricotta di pecora con muesli e kiwi." },
                    spuntino_mattutino: { nome: "Banana e Mandorle", grammatura: "150g + 30g", descrizione: "Banana e mandorle." },
                    pranzo: { nome: "Penne Senatore Cappelli con Tonno e Zucchine", grammatura: "80g + 60g + 200g", descrizione: "Pasta con tonno al naturale e zucchine." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Tacchino, Funghi e Mirtilli", grammatura: "150g + 150g + 125g", descrizione: "Fesa di tacchino con funghi trifolati e mirtilli." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                gio: {
                    colazione: { nome: "Pane secco, burro, marmellata e Banana", grammatura: "90g + 150g", descrizione: "Pane secco con burro, marmellata e banana." },
                    spuntino_mattutino: { nome: "Mirtilli e Semi di zucca", grammatura: "125g + 20g", descrizione: "Mirtilli e semi di zucca." },
                    pranzo: { nome: "Farro con Piselli e Zucca gialla", grammatura: "80g + 60g + 200g", descrizione: "Farro con piselli e zucca." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Sarda a beccafico, Lattuga e Kiwi", grammatura: "150g + 100g + 150g", descrizione: "Sarde a beccafico con lattuga e due kiwi." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                ven: {
                    colazione: { nome: "Latte di vacca, Muesli e Kiwi", grammatura: "200g + 30g + 150g", descrizione: "Latte scremato con muesli e kiwi." },
                    spuntino_mattutino: { nome: "Banana e Nocciole", grammatura: "150g + 30g", descrizione: "Banana e nocciole." },
                    pranzo: { nome: "Riso basmati con Cozze e Pomodorini", grammatura: "80g + 60g + 200g", descrizione: "Riso con cozze e pomodorini freschi." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Salmone, Agretti e Banana", grammatura: "150g + 100g + 150g", descrizione: "Salmone al vapore con agretti e una banana." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                sab: {
                    colazione: { nome: "Pane secco, burro, marmellata e Mirtilli", grammatura: "90g + 125g", descrizione: "Pane secco con burro, marmellata e mirtilli." },
                    spuntino_mattutino: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Una porzione di fiocchi di latte." },
                    pranzo: { nome: "Pasta Senatore Cappelli con Fagioli Borlotti", grammatura: "80g + 120g", descrizione: "Pasta e fagioli borlotti freschi." },
                    spuntino_pomeridiano: { nome: "Fiocchi di latte", grammatura: "85g", descrizione: "Spuntino pomeridiano a base di fiocchi di latte." },
                    cena: { nome: "Bistecca di maiale, Peperoni e Kiwi", grammatura: "150g + 150g + 150g", descrizione: "Bistecca di maiale con peperoni arrostiti e due kiwi." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                },
                dom: {
                    colazione: { nome: "Ricotta di pecora con Banana", grammatura: "80g + 150g", descrizione: "Ricotta fresca con una banana." },
                    spuntino_mattutino: { nome: "Kiwi e Mandorle", grammatura: "150g + 30g", descrizione: "Kiwi e mandorle." },
                    pranzo: { nome: "Piatto libero", grammatura: "A piacere", descrizione: "Pasto libero per concludere il mese." },
                    spuntino_pomeridiano: { nome: "Equilibrio Fortificato", grammatura: "200g", descrizione: "Spuntino con yogurt fortificato." },
                    cena: { nome: "Passato di verdure con ceci, Mirtilli", grammatura: "Piatto abbondante + 125g", descrizione: "Passato di verdure miste con ceci e mirtilli." },
                    spuntino_extra: { nome: "Semi di zucca", grammatura: "20g", descrizione: "Spuntino extra durante la giornata." }
                }
            }
        };

        const shoppingLists = {
            sett.1: {
                "Frutta": [{ name: "Banana", qty: 900, unit: "g" }, { name: "Kiwi", qty: 750, unit: "g" }, { name: "Mirtilli", qty: 500, unit: "g" }],
                "Verdura": [{ name: "Zucchine", qty: 600, unit: "g" }, { name: "Bieta", qty: 100, unit: "g" }, { name: "Carote", qty: 100, unit: "g" }, { name: "Spinaci", qty: 100, unit: "g" }, { name: "Pomodori", qty: 200, unit: "g" }, { name: "Broccoletti", qty: 200, unit: "g" }, { name: "Zucca gialla", qty: 200, unit: "g" }, { name: "Asparagi", qty: 100, unit: "g" }, { name: "Peperoni", qty: 150, unit: "g" }, { name: "Funghi prataioli", qty: 150, unit: "g" }, { name: "Lattuga", qty: 100, unit: "g" }, { name: "Fagiolini", qty: 100, unit: "g" }],
                "Carboidrati": [{ name: "Pasta Senatore Cappelli", qty: 160, unit: "g" }, { name: "Pane secco/integrale", qty: 180, unit: "g" }, { name: "Riso basmati", qty: 80, unit: "g" }, { name: "Farro", qty: 80, unit: "g" }, { name: "Grano saraceno", qty: 160, unit: "g" }, { name: "Riso nero Venere", qty: 80, unit: "g" }],
                "Proteine": [{ name: "Ceci secchi", qty: 60, unit: "g" }, { name: "Petto di tacchino", qty: 150, unit: "g" }, { name: "Lenticchie secche", qty: 60, unit: "g" }, { name: "Sgombro", qty: 150, unit: "g" }, { name: "Piselli freschi", qty: 60, unit: "g" }, { name: "Salmone fresco", qty: 150, unit: "g" }, { name: "Fagioli secchi", qty: 60, unit: "g" }, { name: "Vitellone", qty: 150, unit: "g" }, { name: "Orata fresca", qty: 150, unit: "g" }, { name: "Bistecca di maiale", qty: 150, unit: "g" }, { name: "Vongole", qty: 60, unit: "g" }, { name: "Trota", qty: 150, unit: "g" }],
                "Latticini e Alternative": [{ name: "Yogurt greco intero", qty: 125, unit: "g" }, { name: "Ricotta di vacca", qty: 80, unit: "g" }, { name: "Latte di capra", qty: 200, unit: "ml" }, { name: "Ricotta di pecora", qty: 80, unit: "g" }, { name: "Latte di pecora", qty: 200, unit: "ml" }, { name: "Fiocchi di latte", qty: 255, unit: "g" }, { name: "Equilibrio Fortificato", qty: 800, unit: "g" }],
                "Cereali e Altro": [{ name: "Muesli", qty: 150, unit: "g" }, { name: "Burro di centrifuga", qty: 1, unit: "conf" }, { name: "Marmellata biologica", qty: 1, unit: "conf" }],
                "Frutta Secca e Semi": [{ name: "Mandorle", qty: 60, unit: "g" }, { name: "Noci", qty: 60, unit: "g" }, { name: "Anacardi", qty: 30, unit: "g" }, { name: "Nocciole", qty: 30, unit: "g" }, { name: "Semi di girasole", qty: 20, unit: "g" }, { name: "Semi di zucca", qty: 140, unit: "g" }]
            },
            sett.2: {
                "Frutta": [{ name: "Kiwi", qty: 900, unit: "g" }, { name: "Banana", qty: 900, unit: "g" }, { name: "Mirtilli", qty: 750, unit: "g" }],
                "Verdura": [{ name: "Zucchine", qty: 600, unit: "g" }, { name: "Patate", qty: 200, unit: "g" }, { name: "Zucca gialla", qty: 200, unit: "g" }, { name: "Agretti", qty: 100, unit: "g" }, { name: "Pomodori", qty: 200, unit: "g" }, { name: "Peperoni", qty: 150, unit: "g" }, { name: "Asparagi", qty: 100, unit: "g" }, { name: "Carote", qty: 100, unit: "g" }, { name: "Funghi", qty: 150, unit: "g" }, { name: "Fagiolini", qty: 100, unit: "g" }, { name: "Prezzemolo", qty: 1, unit: "mazzetto" }],
                "Carboidrati": [{ name: "Grano saraceno", qty: 80, unit: "g" }, { name: "Pane secco/integrale", qty: 180, unit: "g" }, { name: "Riso basmati", qty: 160, unit: "g" }, { name: "Penne Senatore Cappelli", qty: 80, unit: "g" }, { name: "Farro", qty: 80, unit: "g" }, { name: "Pasta Senatore Cappelli", qty: 80, unit: "g" }],
                "Proteine": [{ name: "Ceci secchi", qty: 60, unit: "g" }, { name: "Polpo", qty: 200, unit: "g" }, { name: "Lenticchie secche", qty: 140, unit: "g" }, { name: "Fegato di bovino", qty: 150, unit: "g" }, { name: "Tonno al naturale", qty: 60, unit: "g" }, { name: "Pesce spada", qty: 150, unit: "g" }, { name: "Piselli freschi", qty: 60, unit: "g" }, { name: "Sgombro", qty: 150, unit: "g" }, { name: "Cozze", qty: 60, unit: "g" }, { name: "Tonno fresco", qty: 150, unit: "g" }, { name: "Fagioli secchi", qty: 60, unit: "g" }, { name: "Vitellone", qty: 150, unit: "g" }],
                "Latticini e Alternative": [{ name: "Yogurt greco", qty: 125, unit: "g" }, { name: "Ricotta di vacca", qty: 160, unit: "g" }, { name: "Ricotta di pecora", qty: 80, unit: "g" }, { name: "Latte di vacca", qty: 200, unit: "ml" }, { name: "Fiocchi di latte", qty: 340, unit: "g" }, { name: "Equilibrio Fortificato", qty: 600, unit: "g" }],
                "Cereali e Altro": [{ name: "Muesli", qty: 90, unit: "g" }, { name: "Burro di centrifuga", qty: 1, unit: "conf" }, { name: "Marmellata biologica", qty: 1, unit: "conf" }],
                "Frutta Secca e Semi": [{ name: "Nocciole", qty: 30, unit: "g" }, { name: "Mandorle", qty: 60, unit: "g" }, { name: "Semi di zucca", qty: 140, unit: "g" }, { name: "Noci", qty: 30, unit: "g" }]
            },
            sett.3: {
                "Frutta": [{ name: "Kiwi", qty: 750, unit: "g" }, { name: "Banana", qty: 1050, unit: "g" }, { name: "Mirtilli", qty: 375, unit: "g" }],
                "Verdura": [{ name: "Broccoletti", qty: 60, unit: "g" }, { name: "Carote", qty: 100, unit: "g" }, { name: "Peperoni", qty: 150, unit: "g" }, { name: "Fagiolini", qty: 100, unit: "g" }, { name: "Pomodorini", qty: 200, unit: "g" }, { name: "Zucchine", qty: 400, unit: "g" }, { name: "Spinaci", qty: 100, unit: "g" }, { name: "Zucca gialla", qty: 200, unit: "g" }, { name: "Asparagi", qty: 100, unit: "g" }, { name: "Piselli freschi", qty: 240, unit: "g" }],
                "Carboidrati": [{ name: "Pasta Senatore Cappelli", qty: 80, unit: "g" }, { name: "Pane secco/integrale", qty: 180, unit: "g" }, { name: "Riso nero Venere", qty: 80, unit: "g" }, { name: "Farro", qty: 160, unit: "g" }, { name: "Riso basmati", qty: 80, unit: "g" }, { name: "Grano saraceno", qty: 80, unit: "g" }],
                "Proteine": [{ name: "Ceci secchi", qty: 60, unit: "g" }, { name: "Petto di pollo", qty: 150, unit: "g" }, { name: "Lenticchie secche", qty: 160, unit: "g" }, { name: "Salmone fresco", qty: 150, unit: "g" }, { name: "Sgombro", qty: 60, unit: "g" }, { name: "Pesce spada", qty: 150, unit: "g" }, { name: "Fesa di tacchino", qty: 150, unit: "g" }, { name: "Vongole", qty: 60, unit: "g" }, { name: "Sogliola", qty: 150, unit: "g" }, { name: "Triglie", qty: 150, unit: "g" }, { name: "Orata", qty: 150, unit: "g" }],
                "Latticini e Alternative": [{ name: "Yogurt greco", qty: 125, unit: "g" }, { name: "Ricotta di vacca", qty: 160, unit: "g" }, { name: "Latte di pecora", qty: 200, unit: "ml" }, { name: "Fiocchi di latte", qty: 340, unit: "g" }, { name: "Latte di capra", qty: 200, unit: "ml" }, { name: "Equilibrio Fortificato", qty: 600, unit: "g" }],
                "Cereali e Altro": [{ name: "Muesli", qty: 120, unit: "g" }, { name: "Burro di centrifuga", qty: 1, unit: "conf" }, { name: "Marmellata biologica", qty: 1, unit: "conf" }],
                "Frutta Secca e Semi": [{ name: "Anacardi", qty: 30, unit: "g" }, { name: "Noci", qty: 30, unit: "g" }, { name: "Mandorle", qty: 30, unit: "g" }, { name: "Nocciole", qty: 30, unit: "g" }, { name: "Semi di girasole", qty: 20, unit: "g" }, { name: "Arachidi tostate", qty: 30, unit: "g" }, { name: "Semi di zucca", qty: 140, unit: "g" }]
            },
            sett.4: {
                "Frutta": [{ name: "Banana", qty: 900, unit: "g" }, { name: "Kiwi", qty: 900, unit: "g" }, { name: "Mirtilli", qty: 625, unit: "g" }],
                "Verdura": [{ name: "Peperoni", qty: 300, unit: "g" }, { name: "Broccoletti", qty: 200, unit: "g" }, { name: "Cipolle", qty: 100, unit: "g" }, { name: "Fagiolini", qty: 100, unit: "g" }, { name: "Funghi", qty: 150, unit: "g" }, { name: "Lattuga", qty: 100, unit: "g" }, { name: "Agretti", qty: 100, unit: "g" }, { name: "Zucchine", qty: 200, unit: "g" }, { name: "Zucca gialla", qty: 200, unit: "g" }, { name: "Pomodorini", qty: 200, unit: "g" }],
                "Carboidrati": [{ name: "Grano saraceno", qty: 80, unit: "g" }, { name: "Pane secco/integrale", qty: 180, unit: "g" }, { name: "Riso basmati", qty: 160, unit: "g" }, { name: "Penne Senatore Cappelli", qty: 80, unit: "g" }, { name: "Farro", qty: 80, unit: "g" }, { name: "Pasta Senatore Cappelli", qty: 80, unit: "g" }],
                "Proteine": [{ name: "Ceci secchi", qty: 140, unit: "g" }, { name: "Salmone fresco", qty: 150, unit: "g" }, { name: "Lenticchie secche", qty: 60, unit: "g" }, { name: "Fegato di bovino", qty: 150, unit: "g" }, { name: "Tonno al naturale", qty: 60, unit: "g" }, { name: "Fesa di tacchino", qty: 150, unit: "g" }, { name: "Sarde", qty: 150, unit: "g" }, { name: "Cozze", qty: 60, unit: "g" }, { name: "Fagioli Borlotti freschi", qty: 120, unit: "g" }, { name: "Bistecca di maiale", qty: 150, unit: "g" }, { name: "Piselli freschi", qty: 60, unit: "g" }],
                "Latticini e Alternative": [{ name: "Yogurt greco", qty: 125, unit: "g" }, { name: "Ricotta di pecora", qty: 240, unit: "g" }, { name: "Latte di vacca", qty: 200, unit: "ml" }, { name: "Fiocchi di latte", qty: 340, unit: "g" }, { name: "Equilibrio Fortificato", qty: 600, unit: "g" }],
                "Cereali e Altro": [{ name: "Muesli", qty: 90, unit: "g" }, { name: "Burro di centrifuga", qty: 1, unit: "conf" }, { name: "Marmellata biologica", qty: 1, unit: "conf" }],
                "Frutta Secca e Semi": [{ name: "Noci", qty: 30, unit: "g" }, { name: "Nocciole", qty: 60, unit: "g" }, { name: "Mandorle", qty: 60, unit: "g" }, { name: "Semi di zucca", qty: 140, unit: "g" }]
            }
        };

        const mealTypes = {
            colazione: "Colazione",
            spuntino_mattutino: "Spuntino Mattutino",
            pranzo: "Pranzo",
            spuntino_pomeridiano: "Spuntino Pomeridiano",
            cena: "Cena",
            spuntino_extra: "Spuntino Extra"
        };
        const mealOrder = ['colazione', 'spuntino_mattutino', 'pranzo', 'spuntino_pomeridiano', 'cena', 'spuntino_extra'];

        const dayNames = {
            lun: 'Lunedì', mar: 'Martedì', mer: 'Mercoledì', gio: 'Giovedì', ven: 'Venerdì', sab: 'Sabato', dom: 'Domenica'
        };
        const dayKeys = ['lun', 'mar', 'mer', 'gio', 'ven', 'sab', 'dom'];

        let activeWeek = 'sett.1';
        let activeDayKey = 'lun';
        let currentView = 'plan';

        const weekNav = document.getElementById('week-nav');
        const dayNav = document.getElementById('day-nav');
        const mealContainer = document.getElementById('meal-plan-container');
        const shoppingListContainer = document.getElementById('list-view-container');
        const planViewWrapper = document.getElementById('plan-view-wrapper');

        const planViewBtn = document.getElementById('plan-view-btn');
        const listViewBtn = document.getElementById('list-view-btn');

        function createMealCard(mealKey, mealData) {
            const bgColor = mealKey === 'spuntino_extra' ? 'bg-green-600' : 'bg-blue-600';
            return `<div class="meal-card bg-white rounded-xl shadow-lg overflow-hidden flex flex-col md:flex-row mb-6 hover:shadow-xl hover:transform hover:-translate-y-1">
                        <div class="md:w-1/3 ${bgColor} text-white p-6 flex flex-col justify-center items-center">
                            <h3 class="text-xl font-bold">${mealTypes[mealKey]}</h3>
                        </div>
                        <div class="p-6 md:w-2/3">
                            <h4 class="font-bold text-lg text-gray-900">${mealData.nome}</h4>
                            <p class="text-gray-500 font-medium mb-2">${mealData.grammatura}</p>
                            <p class="text-gray-700">${mealData.descrizione}</p>
                        </div>
                    </div>`;
        }

        function displayDayPlan(weekKey, dayKey) {
            const dayData = mealPlan[weekKey]?.[dayKey];
            activeWeek = weekKey;
            activeDayKey = dayKey;

            if (!dayData) {
                mealContainer.innerHTML = '<p class="text-center text-red-500">Nessun dato disponibile.</p>';
                return;
            }

            let content = `<h2 class="text-2xl font-bold text-center mb-6 text-blue-800">${dayNames[dayKey]} - ${weekKey.replace('sett.', 'sett. ')}</h2>`;
            content += mealOrder.map(mealKey => dayData[mealKey] ? createMealCard(mealKey, dayData[mealKey]) : '').join('');

            mealContainer.innerHTML = content;

            updateActiveButtons();
        }

        function displayShoppingList(weekKey) {
            const listData = shoppingLists[weekKey];
            activeWeek = weekKey;
            if (!listData) {
                shoppingListContainer.innerHTML = '<p class="text-center text-red-500">Nessun dato disponibile.</p>';
                return;
            }

            let content = `<h2 class="text-2xl font-bold text-center mb-8 text-blue-800">Lista della Spesa - ${weekKey.replace('sett.', 'sett. ')}</h2>`;
            content += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">';

            for (const category in listData) {
                content += `<div class="bg-white p-6 rounded-xl shadow-md">
                                <h3 class="text-lg font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-4">${category}</h3>
                                <div class="space-y-3">`;
                listData[category].forEach((item, index) => {
                    const itemId = `${weekKey}-${category.replace(/\s+/g, '')}-${index}`;
                    const itemText = `${item.name} <span class="text-gray-500 font-medium">(${item.qty} ${item.unit})</span>`;
                    content += `<div class="shopping-item flex items-center">
                                    <input type="checkbox" id="${itemId}" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer">
                                    <label for="${itemId}" class="ml-3 text-gray-700 cursor-pointer">${itemText}</label>
                                </div>`;
                });
                content += `</div></div>`;
            }

            content += '</div>';
            shoppingListContainer.innerHTML = content;
            updateActiveButtons();
        }

        function animateHeader(newWeekKey, newDayKey) {
            const headerText = document.getElementById('header-text');
            const stickyWeek = document.getElementById('sticky-week');
            const stickyDay = document.getElementById('sticky-day');

            headerText.classList.add('fade-slide-out');

            setTimeout(() => {
                stickyWeek.textContent = newWeekKey.replace('sett.', 'sett. ');
                stickyDay.textContent = dayNames[newDayKey];
                headerText.classList.remove('fade-slide-out');
            }, 500);
        }


        function toggleView(view) {
            const stickyHeader = document.getElementById('sticky-header');
            currentView = view;
            if (view === 'plan') {
                document.getElementById('plan-view-container').classList.remove('hidden');
                document.getElementById('list-view-container').classList.add('hidden');
                planViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
                displayDayPlan(activeWeek, activeDayKey);
            } else {
                document.getElementById('plan-view-container').classList.add('hidden');
                document.getElementById('list-view-container').classList.remove('hidden');
                planViewBtn.classList.remove('active');
                listViewBtn.classList.add('active');
                stickyHeader.classList.remove('visible');
                displayShoppingList(activeWeek);
            }
        }

        function handleWeekChange(weekKey) {
            if (activeWeek !== weekKey) {
                animateHeader(weekKey, activeDayKey);
                activeWeek = weekKey;
                if (currentView === 'plan') {
                    displayDayPlan(weekKey, activeDayKey);
                } else {
                    displayShoppingList(weekKey);
                }
            }
        }

        function updateActiveButtons() {
            document.querySelectorAll('#week-nav .nav-button').forEach(button => {
                button.classList.toggle('active', button.dataset.week === activeWeek);
            });
            if (currentView === 'plan') {
                document.querySelectorAll('#day-nav .day-nav-button').forEach(button => {
                    button.classList.toggle('active', button.dataset.day === activeDayKey);
                });
            }
        }

        function setupNavigation() {
            planViewBtn.onclick = () => toggleView('plan');
            listViewBtn.onclick = () => toggleView('list');

            Object.keys(mealPlan).forEach((weekKey, index) => {
                const button = document.createElement('button');
                button.textContent = `sett. ${index + 1}`;
                button.dataset.week = weekKey;
                button.className = 'nav-button px-4 py-2 rounded-lg text-sm sm:text-base font-medium text-gray-700 hover:bg-blue-100 transition-colors duration-200';
                button.onclick = () => handleWeekChange(weekKey);
                weekNav.appendChild(button);
            });

            dayKeys.forEach(dayKey => {
                const button = document.createElement('button');
                button.textContent = dayNames[dayKey].substring(0, 3);
                button.dataset.day = dayKey;
                button.className = 'day-nav-button px-3 py-2 text-sm sm:text-base border-2 border-gray-300 rounded-lg font-semibold text-gray-600 hover:bg-gray-200 transition-colors duration-200';
                button.onclick = () => {
                    if (activeDayKey !== dayKey) {
                        navigateDay('click', dayKey);
                    }
                };
                dayNav.appendChild(button);
            });
        }

        let touchstartX = 0;
        let touchendX = 0;

        function navigateDay(method, newDayKey = null) {
            let currentIndex = dayKeys.indexOf(activeDayKey);
            let nextIndex;

            if (newDayKey) {
                nextIndex = dayKeys.indexOf(newDayKey);
            } else {
                nextIndex = method === 'next'
                    ? (currentIndex + 1) % dayKeys.length
                    : (currentIndex - 1 + dayKeys.length) % dayKeys.length;
            }

            const nextDayKey = dayKeys[nextIndex];

            if (activeDayKey !== nextDayKey) {
                // Non c'è animazione del contenuto, solo dell'header
                animateHeader(activeWeek, nextDayKey);
                displayDayPlan(activeWeek, nextDayKey);
            }
        }

        function handleGesture() {
            if (currentView !== 'plan') return;
            const swipeThreshold = 50;
            if (touchendX < touchstartX - swipeThreshold) {
                navigateDay('next');
            }
            if (touchendX > touchstartX + swipeThreshold) {
                navigateDay('previous');
            }
        }

        document.body.addEventListener('touchstart', e => {
            touchstartX = e.changedTouches[0].screenX;
        }, { passive: true });

        document.body.addEventListener('touchend', e => {
            touchendX = e.changedTouches[0].screenX;
            handleGesture();
        });

        const stickyHeader = document.getElementById('sticky-header');
        const headerThreshold = 100;

        window.addEventListener('scroll', () => {
            if (currentView === 'plan') {
                if (window.scrollY > headerThreshold) {
                    stickyHeader.classList.add('visible');
                } else {
                    stickyHeader.classList.remove('visible');
                }
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const todayIndex = (new Date().getDay() + 6) % 7;
            activeDayKey = dayKeys[todayIndex];

            setupNavigation();
            toggleView('plan');

            document.getElementById('sticky-week').textContent = activeWeek.replace('sett.', 'sett. ');
            document.getElementById('sticky-day').textContent = dayNames[activeDayKey];
        });

    </script>
</body>

</html>